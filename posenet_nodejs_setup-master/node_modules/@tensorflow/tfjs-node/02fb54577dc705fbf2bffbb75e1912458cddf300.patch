From 02fb54577dc705fbf2bffbb75e1912458cddf300 Mon Sep 17 00:00:00 2001
From: Yihong Wang <yh.wang@ibm.com>
Date: Tue, 28 May 2019 14:06:45 -0700
Subject: [PATCH] Use relative path to link to tf shared libs (#252)

* Use relative path to link to tf shared libs

When linking the tf shared libs for node binding, the symbolic links may
become invalid if the application folder is moved to different directory.
Using relative path to create the symbolic links may avoid this issue.

Signed-off-by: Yihong Wang <yh.wang@ibm.com>
---
 scripts/deps-stage.js | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/scripts/deps-stage.js b/scripts/deps-stage.js
index 8afe12f..7006f20 100644
--- a/scripts/deps-stage.js
+++ b/scripts/deps-stage.js
@@ -49,9 +49,15 @@ async function symlinkDepsLib() {
     throw new Error('Destination path not supplied!');
   }
   try {
-    await symlink(depsLibTensorFlowPath, destLibPath);
+    await symlink(
+        path.relative(path.dirname(destLibPath), depsLibTensorFlowPath),
+        destLibPath);
     if (os.platform() !== 'win32') {
-      await symlink(depsLibTensorFlowFrameworkPath, destFrameworkLibPath);
+      await symlink(
+          path.relative(
+              path.dirname(destFrameworkLibPath),
+              depsLibTensorFlowFrameworkPath),
+          destFrameworkLibPath);
     }
   } catch (e) {
     console.error(
